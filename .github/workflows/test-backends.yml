name: "Backends"

on:
  push:


# These jobs call a template workflow `backend-template.yml`, which performs
# all the necessary steps to run the regression tests of the backend.

# Variables listed under `with` are mandatory, except `test_lib_directory`
# and `test_interface_directory`, which are optional.  `backend_name` must be
# unique, as it is used to identify the cache.
# See `backend-template.yml` for more details.

env:
  # Set environment variables to make secrets available to the template steps
  PULL_NAMD_KEY: secrets.PULL_NAMD_KEY
  PULL_VMD_KEY: secrets.PULL_VMD_KEY
  PULL_VMD_PLUGINS_KEY: secrets.PULL_VMD_PLUGINS_KEY

jobs:

  namd-3-0:
    name: NAMD (3.0.x)
    # Prevent running this job on PRs across different accounts, because
    # secrets wouldn't be shared
    uses: ./.github/workflows/backend-template.yml
    with:
      backend_name: NAMD
      backend_repo: Colvars/namd
      backend_repo_ref: release-3-0-fixes
      path_compile_script: devel-tools/compile-namd.sh
      test_lib_directory: namd/tests/library
      test_interface_directory: namd/tests/interface
      rpath_exe: Linux-x86_64-g++.multicore/namd3
      container_name: CentOS9-devel
    secrets:
      # Choice of license by UIUC prevents sharing the code, hence the secret
      private_key: ${{ secrets.PULL_NAMD_KEY }}
